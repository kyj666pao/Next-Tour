<%- include('../partials/html-head') %> <%- include('../partials/nav') %>

<main class="one-post">
  <div class="post-content">
    <h2><%= posts.topic %></h2>
    <h5><%= posts.date.toISOString().slice(0,10) %></h5>
    <img class="content-img" src="<%= posts.photo %>" alt="" />
    <p><%= posts.content %></p>
    <h4 class="author">Author: <%= posts.author.name %></h4>
    <h4><%= posts.location %></h4>
  </div>
  <% if(posts.author.equals(user?.profile._id)) { %>
  <div>
    <a href="/posts/<%= posts._id %>/edit"><button>Edit This Post</button></a>
    <form action="/posts/<%= posts._id %>?_method=DELETE" method="POST">
      <button type="submit">Delete This Post</button>
    </form>
  </div>
  <% } %> <% if (user) { %>
  <div class="add-comment">
    <form action="/posts/<%= posts._id %>/comments" method="POST">
      <textarea
        name="content"
        id="comment-text"
        cols="30"
        rows="10"
        placeholder="Add comment here"
      ></textarea>
      <button type="submit">Submit</button>
    </form>
  </div>
  <% } else { %>
  <div class="add-comment">
    <p>Please login to leave comment</p>
  </div>
  <% } %> <% posts.comments.forEach(comment => { %>
  <div class="comment">
    <img
      src="<%= comment.author.avatar %>"
      alt="<%= comment.author.name %>'s avatar"
    />
    <p><%= comment.author.name %></p>
    <p><%= comment.content %></p>
    <% if (comment.author.equals(user?.profile._id)) { %>
    <a href="/posts/<%= posts._id %>/comments/<%= comment._id %>/edit">
      <button>Edit</button>
    </a>
    <form
      action="/posts/<%= posts._id %>/comments/<%= comment._id %>?_method=DELETE"
      method="POST"
    >
      <button type="submit">Delete</button>
    </form>
    <% } %>
  </div>
  <% }) %>
</main>

<%- include('../partials/footer') %>
